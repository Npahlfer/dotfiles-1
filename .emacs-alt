(require 'package)
(push '("marmalade" . "http://marmalade-repo.org/packages/")
      package-archives )
(push '("melpa" . "http://melpa.milkbox.net/packages/")
      package-archives)
(setq tramp-default-method "ssh")
(server-start)
(add-to-list 'custom-theme-load-path "~/.emacs.d/themes/")
(add-to-list 'package-archives '("org" . "http://orgmode.org/elpa/") t)
(custom-set-variables
 ;; custom-set-variables was added by Custom.
 ;; If you edit it by hand, you could mess it up, so be careful.
 ;; Your init file should contain only one such instance.
 ;; If there is more than one, they won't work right.
  '(custom-safe-themes
     (quote
       ("64581032564feda2b5f2cf389018b4b9906d98293d84d84142d90d7986032d33" "fac03e096e4b76960a6fec7d38ae7b573adccd9db231b9e7d319fa20daa1f510" "3a899753e50b45d2ae816837d389042fe6c643653ee2779d516456928fa5f477" default))))

(defun is-emacs-osx () (if (string-match "apple-appkit" (version)) (emacs-for-osx-cfg) ) )

(defun emacs-for-osx-cfg ()
  (tool-bar-mode 0)
  (scroll-bar-mode -1)
)

(defun require-packages ()
  (package-initialize)
  (require 'evil)
  (require 'org)
  (require 'powerline)
  (require 'powerline-evil)
  (require 'key-chord)
)

(defun key-bindings ()
  (key-chord-define evil-insert-state-map  "jk" 'evil-normal-state)
  (define-key global-map "\C-cl" 'org-store-link)
  (define-key global-map "\C-ca" 'org-agenda)
)

(defadvice handle-delete-frame (around my-handle-delete-frame-advice activate)
  "Hide Emacs instead of closing the last frame"
  (let ((frame   (posn-window (event-start event)))
        (numfrs  (length (frame-list))))
    (if (> numfrs 1)
      ad-do-it
      (do-applescript "tell application \"System Events\" to tell process \"Emacs\" to set visible to false"))))


(defun post-init-hook ()
  (require-packages)
  (load-theme 'monokai)
  (powerline-default-theme)
  (setq org-log-done t)
  (evil-mode 1)
  (global-relative-line-numbers-mode)
  (key-chord-mode 1)
  (editorconfig-mode 1)
  (global-whitespace-mode)
  (set-face-foreground 'whitespace-newline "gray20")
  (set-face-foreground 'whitespace-tab "gray25")
  (set-face-foreground 'whitespace-indentation "gray34")
  (setq whitespace-empty 'inverse-video)
  (is-emacs-osx)
  (key-bindings)
  )

(add-hook 'after-init-hook 'post-init-hook)
